# Рабочее окружение

Кирилл Корняков (Intel, ННГУ)\
Апрель 2019

<!-- TODO
    - избежать повторений с лекцией про Automation
    - Демонстрация
-->

# Содержание

1. UNIX
1. Инструменты командной строки
1. Краткое упоминание про скриптовые языки

# Основные инструменты программиста

1. __Командная строка__
1. Текстовый редактор
1. Файловый менеджер
1. __Браузер__
1. Почтовый клиент
1. Мессенджеры

# Вредные советы

1. Установите себе Linux, и проживите на нем несколько лет.
1. Потом купите MacBook и живите нормальной жизнью :-)

# UNIX — OS для разработчиков

- Огромное количество утилит на любой случай жизни
    - find, cron, tar, sed, etc.
- Вместе со скриптовыми языками (Bash, Perl, Python, etc)\
  предоставляет широчайшие возможности для автоматизации

_Замечание: У любителей Windows нет поводов для расстройств!_

# Пример: Составные команды — философия

> This is the Unix philosophy:\
    — Write programs that do one thing and do it well.\
    — Write programs to work together.\
    — Write programs to handle text streams, because that is a universal interface.

Doug McIlroy

# Пример: Составные команды

Общая схема:

```bash
    $ program1 | program2 | program3
```

Занимаемое место в директории:

```bash
    $ du -sh * | sort -hr
```

Удаление пробелов в конце строки и замена tab'ов на 4 пробела:

```bash
    $ cp main.cpp main.cpp.bak && cat main.cpp.bak | sed 's/\t/    /g' | sed 's/\s*$//' > main.cpp
```

Количество просмотров видео на YouTube:

```bash
    $ curl "https://www.youtube.com/watch?v=M9ycFnR_V4I" 2>/dev/null | \
    sed -n 's/\(.*\)"view_count":"\([^"]*\)"\(.*\)/\2/p'
```

# Базовая работа с командной строкой

```bash
    $ cd
    $ cd --
    $ autojump
```

# Инструменты командной строки

1. Просмотр
    - `cat/tac`, `head/tail`, `less`
1. Поиск
    - `grep`, `ack`, The Silver Searcher
1. Обработка
    - `sed`, `awk`

# Grep examples

- `grep -nIHR "^#" --include=*.md ./`
    - Вывод всех заголовков в Markdown файлах ("`| wc -l`" добавит их подсчет)
- `grep -nIHR "class.*Matcher" --include=*.hpp -B1 ./`
    - Печать деклараций всех классов, содержащих слово Matcher (+одна строка до)

# Sed examples

Stream editor

  - `sed 's/foo/bar/g'` — заменяет foo на bar
  - `sed '/baz/s/foo/bar/g'` — то же самое, но если строка содержит baz
  - `sed 's/[ \t]*$//'` — удалить "висячие" пробельные символы
  - `sed '/regex/G'` — вставить пустую строку под каждой, содержащей "regex"
  - `sed 'n;n;n;n;G;'` — вставить пустую строку через каждые 5
  - `sed -n '$='` — посчитать количество строк
  - `sed '1,10d'` — удалить первые 10 строк файла

# Awk examples

> awk — pattern-directed scanning and processing language

Authors: Aho, Weinberger, Kernighan

Примеры:

  - `awk '{print NR "\t" $0}'` — распечатать файл с номерами строк
  - `awk 'END{print NR}'` — вывести число строк в файле
  - `awk '{print $2, $1}'` — распечатать второе и первое поле в обратном порядке
  - `awk '{s=0; for (i=1; i<=NF; i++) s=s+$i; print s}'` — вывести сумму полей для каждой строки
  - `awk '{sub(/[ \t]+$/, "")};1'` — удалить "висячие" пробельные символы
  - `awk '{l=length();s=int((79-l)/2); printf "%"(s+l)"s\n",$0}' filename` — центрировать и распечатать файл

# Составные примеры

  - Суммировать проценты в определенных строках лога

```bash
$ grep -nIHR "HPWL impr" ./vlsi.log | sed -n '1,5p' |
 awk '{ print $NF }' | awk '{for (i=1; i<=NF; i++) s=s+$i}; END{print s}'
```
 - Слить два текстовых файла в один отсортированный.\
   Попутно обрезать в одном файле все `.0` у координат

```bash
$ cat coords1.dat coords2.dat | sort | sed 's/.0//g' > output.dat
```

# Скриптовые языки

- Perl
    - Practical Extraction and Report Language
    - Создан Ларри Уоллом, лингвистом по образованию
    - Замена для `awk` и `sed`
    - Богатые возможности по работе с текстом, встроенная в синтаксис поддержка регулярных выражений
- Python
    - Есть мнение, что он все-таки победил как язык общего назначения

# dotfiles

<https://dotfiles.github.io>

Хранение привычного окружения.

# Ключевые моменты

1. Установите и изучите инструменты командной строки
    - cat, less, head/tail
    - grep, sed, awk

# Контрольные вопросы

1. Предложите командную строку для:
    - Печати всех заголовков первого и второго уровня в файле Markdown (#-нотация)
    - Объявлений виртуальных методов в директории с исходниками

# Спасибо!

Вопросы?
